{% extends 'dashboard/index.html' %}

{% if g.user %}

	{% block navigation %}
	<nav id="navigation">
	  <a href="{{ url_for( 'cards_manager.index') }}">Cards</a>
	  <a class="current" href="{{ url_for( 'users_analytics.index') }}">Users</a>
	</nav>
	{% endblock %}

    {% block content %}
	    {% if status == "error" %}
	    		<h2>Error</h2>
	    		<p><strong>Could not fetch data:</strong> {{reason}}</p>
	    		<p>Please contact the administrator.</p>
	    		<p>Error code: {{error_id}}</p>
	    {% else %}
	    	<script>
	    		document.addEventListener("DOMContentLoaded", function(event) { 
					const stats_data = JSON.parse('{{users|tojson}}'); // Make jinja print data as 
JSON
					// Here's the user's table data as JS object
					console.log(stats_data);
				});

	    	</script>
	    	<section>
	    		<h3>Pagination</h3>
		    	<a href="{{first_page}}">[ |< ]</a>
		    	{% if prev_page %}
		    		<a href="{{prev_page}}">[ << ]</a>
		    	{% else %}
		    		<a href="#">[ __ ]</a>
		    	{% endif%}
		    	{% if next_page %}
		    		<a href="{{next_page}}">[ >> ]</a>
		    	{% else %}
		    		<a href="#">[ __ ]</a>
		    	{% endif%}
		    	<a href="{{last_page}}">[ >| ]</a>
		    	<span>page: {{this_page}}/{{total_pages}}</span>
		    	
		    	<h3>Name search</h3>
		    	<form method="get" action="{{request.path}}" >
					<label for="uname">Search by username</label>
					<input name="uname" placeholder="{{request.args.get('uname', '')}}">
					<input type="submit" value="Search">
			    </form> 

			    {% if request.args.get("uname", None) %}
			    <a href="{{request.path}}">[ Clear search ]</a>
			    {% endif %}
		    	
		    	<h2>Users</h2>


			    {% if users %}
		    		<!-- Render users table -->
					<!-- jinja var users is a list of dicts  -->
		    		 <table>
		    		  <tr> <!-- first table row, print the keys of the first dict of the 'users' list -->
		    		  	{% for col in users[0].keys() %}
		    		    <th>{{col}}</th>
		    		    {% endfor %}
		    		  </tr>
			    		{% for user in users %}

		    		  <tr> <!-- other rows, print the values of every dict of the 'users' list -->
	    				{% for val in user.values() %}
		    		  	<th>{{val}}</th>
	    		  	  	{% endfor %}  	
		    		  </tr>

		    		{% endfor%}
		    		</table>
	    		{% endif%}

	    	</section>
		    	
	    {% endif %}
<!-- 
	    <h3>--------- UPLOAD FORM FOR TEST----------</h3>

	    <form method="post" action="/cards/image/" enctype="multipart/form-data">
			<label for="file">Select image to upload:</label>
			<input type="file" name="file">
			<input type="submit" value="Upload">
	    </form> -->


    {% endblock %}

{% endif %}